<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>EDBP ãƒ–ãƒ­ãƒƒã‚¯å®šç¾©ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆãƒ–ãƒ©ãƒ³ã‚¯ï¼‰</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f7f9; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; margin-bottom: 25px; }
        .section-header { 
            margin-top: 30px; 
            padding: 8px 0; 
            border-bottom: 2px solid #bdc3c7; 
            color: #3498db; 
            font-size: 1.2em; 
            font-weight: bold;
        }
        label { display: block; margin-top: 15px; font-weight: bold; color: #555; }
        input[type="text"], textarea, input[type="color"] {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus, textarea:focus { border-color: #3498db; }
        textarea { resize: vertical; min-height: 80px; }
        .code-section { background-color: #ecf0f1; padding: 15px; border-radius: 5px; margin-top: 15px; border-left: 5px solid #95a5a6; }
        .flex-group { display: flex; gap: 20px; }
        .flex-group > div { flex: 1; }
        .color-input-group { display: flex; align-items: flex-end; }
        #color-hex { flex-grow: 1; margin-right: 10px; }
        #color-preview { width: 40px; height: 40px; border: 2px solid #333; border-radius: 5px; margin-bottom: 5px; background-color: #ffffff; }
        
        button {
            margin-top: 25px;
            padding: 12px 25px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #27ae60; }
        #json-output { 
            margin-top: 30px; 
            white-space: pre-wrap; 
            background-color: #2c3e50; 
            color: #ecf0f1; 
            padding: 20px; 
            border-radius: 5px; 
            font-family: 'Consolas', 'Courier New', monospace; 
            overflow-x: auto;
            display: none;
        }
        .required::after { content: " *"; color: #e74c3c; }
        .note { font-size: 0.9em; color: #95a5a6; margin-top: 5px; }

        /* Dynamic Item Management Styles */
        .dynamic-item { border: 1px solid #bdc3c7; padding: 10px; margin-bottom: 10px; border-radius: 4px; position: relative; }
        .remove-btn { 
            position: absolute; 
            top: 5px; 
            right: 5px; 
            background: #e74c3c; 
            color: white; 
            border: none; 
            border-radius: 3px; 
            padding: 2px 6px; 
            cursor: pointer;
        }
        .add-btn { 
            background: #3498db; 
            padding: 8px 15px; 
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ§© EDBP ãƒ–ãƒ­ãƒƒã‚¯å®šç¾©ä½œæˆãƒ„ãƒ¼ãƒ« (ãƒ–ãƒ©ãƒ³ã‚¯)</h1>
    <p>æä¾›ã•ã‚ŒãŸJSONã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
    
    <form id="blockDefinitionForm">

        <div class="section-header">åŸºæœ¬å®šç¾© (å¿…é ˆ)</div>
        <div class="flex-group">
            <div>
                <label for="id" class="required">id (ãƒ–ãƒ­ãƒƒã‚¯ID / ãƒ•ã‚¡ã‚¤ãƒ«å):</label>
                <input type="text" id="id" value="" required placeholder="ä¾‹: my_new_block">
            </div>
            <div>
                <label for="category" class="required">category (ã‚«ãƒ†ã‚´ãƒªID / ãƒ•ã‚©ãƒ«ãƒ€å):</label>
                <input type="text" id="category" value="" required placeholder="ä¾‹: action">
            </div>
        </div>
        
        <label for="name" class="required">name (ãƒ–ãƒ­ãƒƒã‚¯è¡¨ç¤ºå):</label>
        <input type="text" id="name" value="" required placeholder="ä¾‹: ğŸš€ æ–°ã—ã„å‡¦ç†ã‚’å®Ÿè¡Œ">

        <label for="color-hex" class="required">color (åŸºæœ¬è‰² - 16é€²æ•°):</label>
        <div class="color-input-group">
            <input type="text" id="color-hex" value="#3498db" pattern="#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?" required oninput="updateColorPreview(this.value)">
            <input type="color" id="color-picker" value="#3498db" oninput="updateColorHex(this.value)">
            <div id="color-preview" style="background-color: #3498db;"></div>
        </div>
        <div class="note">â€»ã‚¬ã‚¤ãƒ‰ã«ã‚ˆã‚Š16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚</div>


        <div class="section-header">è©³ç´°æƒ…å ± (ä»»æ„)</div>
        <label for="description">description (èª¬æ˜ / ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ç”¨):</label>
        <textarea id="description" placeholder="ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ãŒä½•ã‚’ã™ã‚‹ã®ã‹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚"></textarea>
        
        <div class="section-header">Inputs (å€¤å…¥åŠ›ã‚½ã‚±ãƒƒãƒˆ)</div>
        <div id="inputs-container">
        </div>
        <button type="button" class="add-btn" onclick="addInputItem()">+ Input (å…¥åŠ›å€¤) ã‚’è¿½åŠ </button>

        <div class="section-header">Statements (å®Ÿè¡Œæ–‡ã‚½ã‚±ãƒƒãƒˆ)</div>
        <div id="statements-container">
        </div>
        <button type="button" class="add-btn" onclick="addStatementItem()">+ Statement (å®Ÿè¡Œãƒ–ãƒ­ãƒƒã‚¯) ã‚’è¿½åŠ </button>

        <div class="section-header">Code (ã‚³ãƒ¼ãƒ‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - å¿…é ˆ)</div>
        <div class="code-section">
            <label for="code-python" class="required">Pythonã‚³ãƒ¼ãƒ‰:</label>
            <textarea id="code-python" rows="5" placeholder="ä¾‹: print('Hello')\n{{DO}}"></textarea>
            <div class="note">â€»`{{ID}}`å½¢å¼ã§`statements`ã‚„`inputs`ã‚’å±•é–‹ã—ã¾ã™ã€‚</div>
        </div>

        <button type="button" onclick="generateJson()">ğŸ’¾ JSONã‚’ç”Ÿæˆ</button>

        <div id="json-output"></div>

    </form>
</div>

<script>
    // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã¨ãƒ†ã‚­ã‚¹ãƒˆã®åŒæœŸ
    function updateColorPreview(hex) {
        const preview = document.getElementById('color-preview');
        const picker = document.getElementById('color-picker');
        
        if (/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(hex)) {
            preview.style.backgroundColor = hex;
            picker.value = hex;
        } else {
             preview.style.backgroundColor = '#ccc';
        }
    }
    
    function updateColorHex(hex) {
        document.getElementById('color-hex').value = hex;
        document.getElementById('color-preview').style.backgroundColor = hex;
    }

    // å‹•çš„ãª Inputs ã®è¿½åŠ 
    function addInputItem(id = '', type = 'string', label = '') {
        const container = document.getElementById('inputs-container');
        const item = document.createElement('div');
        item.className = 'dynamic-item';
        item.setAttribute('data-type', 'input');
        
        item.innerHTML = `
            <label>ID:</label><input type="text" class="input-id" value="${id}" required placeholder="ä¾‹: TEXT_INPUT">
            <label>ã‚¿ã‚¤ãƒ— (string/number/boolean/any):</label><input type="text" class="input-type" value="${type || 'string'}" required>
            <label>ãƒ©ãƒ™ãƒ«:</label><input type="text" class="input-label" value="${label}" placeholder="ä¾‹: è¡¨ç¤ºã™ã‚‹æ–‡å­—">
            <button type="button" class="remove-btn" onclick="removeItem(this)">å‰Šé™¤</button>
        `;
        container.appendChild(item);
    }

    // å‹•çš„ãª Statements ã®è¿½åŠ 
    function addStatementItem(id = '', label = '') {
        const container = document.getElementById('statements-container');
        const item = document.createElement('div');
        item.className = 'dynamic-item';
        item.setAttribute('data-type', 'statement');
        
        item.innerHTML = `
            <label>ID:</label><input type="text" class="statement-id" value="${id}" required placeholder="ä¾‹: DO">
            <label>ãƒ©ãƒ™ãƒ«:</label><input type="text" class="statement-label" value="${label}" placeholder="ä¾‹: å®Ÿè¡Œã™ã‚‹å‡¦ç†">
            <button type="button" class="remove-btn" onclick="removeItem(this)">å‰Šé™¤</button>
        `;
        container.appendChild(item);
    }
    
    // ã‚¢ã‚¤ãƒ†ãƒ ã®å‰Šé™¤
    function removeItem(button) {
        button.closest('.dynamic-item').remove();
    }

    // JSON ç”Ÿæˆé–¢æ•°
    function generateJson() {
        const form = document.getElementById('blockDefinitionForm');
        
        // Inputs ã®åé›†
        const inputs = Array.from(document.querySelectorAll('#inputs-container .dynamic-item')).map(item => ({
            id: item.querySelector('.input-id').value,
            type: item.querySelector('.input-type').value,
            label: item.querySelector('.input-label').value
        }));
        
        // Statements ã®åé›†
        const statements = Array.from(document.querySelectorAll('#statements-container .dynamic-item')).map(item => ({
            id: item.querySelector('.statement-id').value,
            label: item.querySelector('.statement-label').value
        }));

        // ãƒ–ãƒ­ãƒƒã‚¯å®šç¾©ã®æ§‹ç¯‰ (å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒç©ºã®å ´åˆã¯ JSON ã‚’å‡ºåŠ›ã—ãªã„)
        if (!form['id'].value || !form['category'].value || !form['name'].value || !form['color-hex'].value || !form['code-python'].value) {
            alert("å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
            return;
        }

        const blockDefinition = {
            "schema": "edbb.block.v1",
            "id": form['id'].value,
            "category": form['category'].value,
            "name": form['name'].value,
            
            // descriptionã¯ç©ºã§ãªã‘ã‚Œã°å«ã‚ã‚‹ (ä»»æ„)
            ...(form['description'].value && { "description": form['description'].value }), 
            
            "color": form['color-hex'].value,
            
            // inputs/statementsã¯ç©ºã§ãªã‘ã‚Œã°å«ã‚ã‚‹
            ...(inputs.length > 0 && { "inputs": inputs }), 
            ...(statements.length > 0 && { "statements": statements }), 
            
            "code": {
                "python": form['code-python'].value
            }
        };

        const jsonOutput = document.getElementById('json-output');
        jsonOutput.textContent = JSON.stringify(blockDefinition, null, 2);
        jsonOutput.style.display = 'block';
        jsonOutput.scrollIntoView({ behavior: 'smooth' });
    }
    
    // åˆæœŸã‚«ãƒ©ãƒ¼è¨­å®š
    document.addEventListener('DOMContentLoaded', function() {
        updateColorPreview(document.getElementById('color-hex').value);
    });
</script>

</body>
</html>
